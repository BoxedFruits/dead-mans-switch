{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/samba/Desktop/ETH Projects/dead-mans-switch/dead-mans-switch-front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/samba/Desktop/ETH Projects/dead-mans-switch/dead-mans-switch-front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:/Users/samba/Desktop/ETH Projects/dead-mans-switch/dead-mans-switch-front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/Users/samba/Desktop/ETH Projects/dead-mans-switch/dead-mans-switch-front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"C:/Users/samba/Desktop/ETH Projects/dead-mans-switch/dead-mans-switch-front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/Users/samba/Desktop/ETH Projects/dead-mans-switch/dead-mans-switch-front-end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import{Modal,Button,Space,Input,Spin,Typography,Divider,Tooltip}from'antd';import React from'react';import DeadMansContract from'../utils/DeadMansContract.abi.json';import{ethers}from\"ethers\";import{LoadingOutlined}from'@ant-design/icons';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var antIcon=/*#__PURE__*/_jsx(LoadingOutlined,{style:{fontSize:92,width:100},spin:true});var Text=Typography.Text,Paragraph=Typography.Paragraph;var ContractInteraction=/*#__PURE__*/function(_React$Component){_inherits(ContractInteraction,_React$Component);var _super=_createSuper(ContractInteraction);function ContractInteraction(){var _this;_classCallCheck(this,ContractInteraction);_this=_super.call(this);_this.initContract=function(){if(_this.state.contract==undefined){var provider=new ethers.providers.Web3Provider(ethereum);var signer=provider.getSigner();var contract=new ethers.Contract(_this.props.address,DeadMansContract.abi,signer);_this.setState({contract:contract});return contract;}else{return _this.state.contract;}};_this.isActive=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var tx;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return _this.initContract().isActive();case 3:tx=_context.sent;_this.setState({pendingTx:false,active:tx});_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);setTimeout(function(){// For some reason when this compontent init's this function doesn't properly execute when initing the contract. This is a temp fix\n_this.isActive();},100);case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));_this.tick=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var tx;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return _this.initContract().tick();case 3:tx=_context2.sent;_this.setState({pendingTx:true});_context2.next=7;return tx.wait();case 7:_this.setState({pendingTx:false});_this.getNextTimeStamp();_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[0,11]]);}));_this.getNextTimeStamp=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var tx;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return _this.initContract().getNextTimeStamp();case 3:tx=_context3.sent;_this.setState({pendingTx:false,nextTimeStamp:Date(parseInt(BigInt(tx))).toString()});_context3.next=9;break;case 7:_context3.prev=7;_context3.t0=_context3[\"catch\"](0);case 9:case\"end\":return _context3.stop();}}},_callee3,null,[[0,7]]);}));_this.setUrl=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var newUrl,tx;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;newUrl=document.getElementById(\"setUrl\").value;_context4.next=4;return _this.initContract().setUrl(newUrl);case 4:tx=_context4.sent;_this.setState({pendingTx:true});_context4.next=8;return tx.wait();case 8:_this.setState({pendingTx:false});_this.getUrl();_context4.next=15;break;case 12:_context4.prev=12;_context4.t0=_context4[\"catch\"](0);console.log(_context4.t0);case 15:case\"end\":return _context4.stop();}}},_callee4,null,[[0,12]]);}));_this.getUrl=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var tx;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return _this.initContract().getUrl();case 3:tx=_context5.sent;_this.setState({pendingTx:true});_this.setState({pendingTx:false,url:tx});_context5.next=11;break;case 8:_context5.prev=8;_context5.t0=_context5[\"catch\"](0);console.log(_context5.t0);case 11:case\"end\":return _context5.stop();}}},_callee5,null,[[0,8]]);}));_this.getDecryptionKey=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var tx;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;_context6.next=3;return _this.initContract().getDecryptionKey();case 3:tx=_context6.sent;_context6.next=6;return tx.wait();case 6:_this.setState({showDecryptionKeyText:true,decryptionKey:tx});_context6.next=12;break;case 9:_context6.prev=9;_context6.t0=_context6[\"catch\"](0);_this.setState({showDecryptionKeyText:true,decryptionKey:\"The switch has not been activated yet\"});case 12:case\"end\":return _context6.stop();}}},_callee6,null,[[0,9]]);}));_this.renounceOwnershipModal=function(){_this.setState({isModalRenounceVisible:true});};_this.renounceOwnership=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){var tx;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return _this.initContract().renounceOwnership();case 2:tx=_context7.sent;_context7.next=5;return tx.wait();case 5:_this.handleRenounceCancel();case 6:case\"end\":return _context7.stop();}}},_callee7);}));_this.handleRenounceCancel=function(){_this.setState({isModalRenounceVisible:false});};_this.defuse=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){var tx;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return _this.initContract().defuse();case 2:tx=_context8.sent;_context8.next=5;return tx.wait();case 5:_this.getNextTimeStamp();_this.isActive();_this.handleDefuseCancel();case 8:case\"end\":return _context8.stop();}}},_callee8);}));_this.defuseModal=function(){_this.setState({isModalDefuseVisible:true});};_this.handleDefuseCancel=function(){_this.setState({isModalDefuseVisible:false});};_this.state={active:false,url:\"\",decryptionKey:\"\",nextTimeStamp:\"\",pendingTx:false,showTickText:false,showGetDecryptionText:false,isModalRenounceVisible:false,isModalDefuseVisible:false};return _this;}_createClass(ContractInteraction,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(){return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.prev=0;_context9.next=3;return this.isActive();case 3:_context9.next=5;return this.getUrl();case 5:_context9.next=7;return this.getNextTimeStamp();case 7:_context9.next=12;break;case 9:_context9.prev=9;_context9.t0=_context9[\"catch\"](0);console.log(_context9.t0);case 12:case\"end\":return _context9.stop();}}},_callee9,this,[[0,9]]);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){// Add error message if user denies transactions\nreturn/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Divider,{plain:true,children:\"Interact with Smart Contract\"}),/*#__PURE__*/_jsxs(Paragraph,{children:[\"Contract Address: \",/*#__PURE__*/_jsx(Text,{underline:true,children:this.props.address})]}),this.state.pendingTx?/*#__PURE__*/_jsx(Spin,{indicator:antIcon,style:{width:\"100%\",marginTop:\"4rem\"}}):/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",children:[/*#__PURE__*/_jsxs(Paragraph,{children:[\"Status of switch: \",/*#__PURE__*/_jsxs(Text,{underline:true,children:[this.state.active===true?\"still \":\"not \",\" being monitored. \"]})]}),/*#__PURE__*/_jsxs(Paragraph,{children:[\"Next timestamp: \",/*#__PURE__*/_jsx(Text,{underline:true,children:this.state.nextTimeStamp})]}),/*#__PURE__*/_jsxs(Paragraph,{children:[\"URL to file: \",/*#__PURE__*/_jsx(Text,{underline:true,children:this.state.url===\"\"?\"There was no URL set or was left blank\":this.state.url})]}),/*#__PURE__*/_jsx(Tooltip,{title:\"Update the switch by updating the next timestamp of when the switch should activate\",children:/*#__PURE__*/_jsx(Button,{onClick:this.tick,children:\"Check on Switch\"})}),/*#__PURE__*/_jsx(Tooltip,{title:\"Defuse the dead man's switch\",children:/*#__PURE__*/_jsx(Button,{onClick:this.defuse,children:\"Defuse\"})}),/*#__PURE__*/_jsx(Tooltip,{title:\"Change the owner of the contract to 0x0. You will no longer be able to interact with the contract and will activate if not already defused\",children:/*#__PURE__*/_jsx(Button,{onClick:this.renounceOwnershipModal,children:\"Renounce Ownership\"})}),/*#__PURE__*/_jsx(Tooltip,{title:\"Set the URL of the encrypted file\",children:/*#__PURE__*/_jsx(Button,{onClick:this.setUrl,children:\"Set Url\"})}),/*#__PURE__*/_jsx(Input,{size:\"large\",id:\"setUrl\"}),/*#__PURE__*/_jsx(Button,{onClick:this.getDecryptionKey,children:\"Reveal Decryption Key\"}),this.state.showDecryptionKeyText&&/*#__PURE__*/_jsx(Paragraph,{children:this.state.decryptionKey})]}),/*#__PURE__*/_jsxs(Modal,{id:\"renounce\",title:\"Are you sure?\",visible:this.state.isModalRenounceVisible,footer:[/*#__PURE__*/_jsx(Button,{onClick:this.handleRenounceCancel,children:\"Cancel\"},\"back\"),/*#__PURE__*/_jsx(Button,{onClick:this.renounceOwnership,children:\"Renounce Ownership\"},\"submit\")],children:[/*#__PURE__*/_jsx(Paragraph,{children:\"Renouncing the ownership of the Dead Man's Switch means that if not defused, there is no stopping the switch from activating.\"}),/*#__PURE__*/_jsx(Paragraph,{children:\"This action is is irreversible.\"})]}),/*#__PURE__*/_jsxs(Modal,{id:\"defuse\",title:\"Are you sure?\",visible:this.state.isModalDefuseVisible,footer:[/*#__PURE__*/_jsx(Button,{onClick:this.defuse,children:\"Cancel\"},\"back\"),/*#__PURE__*/_jsx(Button,{onClick:this.handleDefuseCancel,children:\"Defuse\"},\"submit\")],children:[/*#__PURE__*/_jsx(Paragraph,{children:\"Defusing the Dead Man's Switch means that the danger has passed and the use of the switch is no longer needed. The decryption key will not be revealed and you will no longer need to check on the switch.\"}),/*#__PURE__*/_jsx(Paragraph,{children:\"This action is is irreversible.\"})]})]});}}]);return ContractInteraction;}(React.Component);export default ContractInteraction;","map":{"version":3,"sources":["C:/Users/samba/Desktop/ETH Projects/dead-mans-switch/dead-mans-switch-front-end/src/components/contractInteraction.jsx"],"names":["Modal","Button","Space","Input","Spin","Typography","Divider","Tooltip","React","DeadMansContract","ethers","LoadingOutlined","antIcon","fontSize","width","Text","Paragraph","ContractInteraction","initContract","state","contract","undefined","provider","providers","Web3Provider","ethereum","signer","getSigner","Contract","props","address","abi","setState","isActive","tx","pendingTx","active","setTimeout","tick","wait","getNextTimeStamp","console","log","nextTimeStamp","Date","parseInt","BigInt","toString","setUrl","newUrl","document","getElementById","value","getUrl","url","getDecryptionKey","showDecryptionKeyText","decryptionKey","renounceOwnershipModal","isModalRenounceVisible","renounceOwnership","handleRenounceCancel","defuse","handleDefuseCancel","defuseModal","isModalDefuseVisible","showTickText","showGetDecryptionText","marginTop","Component"],"mappings":"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","sourcesContent":["import { Modal, Button, Space, Input, Spin, Typography, Divider, Tooltip } from 'antd';\r\nimport React from 'react';\r\nimport DeadMansContract from '../utils/DeadMansContract.abi.json';\r\nimport { ethers } from \"ethers\";\r\nimport { LoadingOutlined } from '@ant-design/icons';\r\n\r\nconst antIcon = <LoadingOutlined style={{ fontSize: 92, width: 100 }} spin />;\r\nconst { Text, Paragraph } = Typography;\r\n\r\nclass ContractInteraction extends React.Component {\r\n\r\n    constructor() {\r\n        super();\r\n        this.state = {\r\n            active: false,\r\n            url: \"\",\r\n            decryptionKey: \"\",\r\n            nextTimeStamp: \"\",\r\n            pendingTx: false,\r\n            showTickText: false,\r\n            showGetDecryptionText: false,\r\n            isModalRenounceVisible: false,\r\n            isModalDefuseVisible: false\r\n        };\r\n    }\r\n\r\n    initContract = () => {\r\n        if (this.state.contract == undefined) {\r\n            const provider = new ethers.providers.Web3Provider(ethereum);\r\n            const signer = provider.getSigner();\r\n            const contract = new ethers.Contract(this.props.address, DeadMansContract.abi, signer);\r\n            this.setState({ contract: contract });\r\n            return contract;\r\n        } else {\r\n            return this.state.contract;\r\n        }\r\n    }\r\n\r\n    isActive = async () => {\r\n        try {\r\n            const tx = await this.initContract().isActive();\r\n\r\n            this.setState({ pendingTx: false, active: tx });\r\n        } catch (e) {\r\n            setTimeout(() => {\r\n                // For some reason when this compontent init's this function doesn't properly execute when initing the contract. This is a temp fix\r\n                this.isActive();\r\n            }, 100);\r\n        }\r\n    };\r\n\r\n    tick = async () => {\r\n        try {\r\n            const tx = await this.initContract().tick();\r\n\r\n            this.setState({ pendingTx: true });\r\n\r\n            await tx.wait();\r\n            this.setState({ pendingTx: false })\r\n            this.getNextTimeStamp();\r\n        } catch (e) {\r\n            console.log(e);\r\n        }\r\n    };\r\n\r\n    getNextTimeStamp = async () => {\r\n        try {\r\n            const tx = await this.initContract().getNextTimeStamp();\r\n            this.setState({ pendingTx: false, nextTimeStamp: Date(parseInt(BigInt(tx))).toString() });\r\n        } catch (e) {\r\n\r\n        }\r\n    }\r\n\r\n    setUrl = async () => {\r\n        try {\r\n            const newUrl = document.getElementById(\"setUrl\").value;\r\n            const tx = await this.initContract().setUrl(newUrl);\r\n\r\n            this.setState({ pendingTx: true });\r\n            await tx.wait();\r\n            this.setState({ pendingTx: false });\r\n            this.getUrl();\r\n        } catch (e) {\r\n            console.log(e);\r\n        }\r\n    };\r\n\r\n    getUrl = async () => {\r\n        try {\r\n            const tx = await this.initContract().getUrl();\r\n            this.setState({ pendingTx: true });\r\n\r\n            this.setState({ pendingTx: false, url: tx });\r\n        } catch (e) {\r\n            console.log(e);\r\n        }\r\n    };\r\n\r\n    getDecryptionKey = async () => {\r\n        try {\r\n            const tx = await this.initContract().getDecryptionKey();\r\n\r\n            await tx.wait();\r\n            this.setState({ showDecryptionKeyText: true, decryptionKey: tx });\r\n        } catch (e) {\r\n            this.setState({ showDecryptionKeyText: true, decryptionKey: \"The switch has not been activated yet\" });\r\n        }\r\n    };\r\n\r\n    renounceOwnershipModal = () => {\r\n        this.setState({ isModalRenounceVisible: true });\r\n    }\r\n\r\n    renounceOwnership = async () => {\r\n        const tx = await this.initContract().renounceOwnership();\r\n\r\n        await tx.wait();\r\n        this.handleRenounceCancel();\r\n    };\r\n\r\n    handleRenounceCancel = () => {\r\n        this.setState({ isModalRenounceVisible: false });\r\n    };\r\n\r\n    defuse = async () => {\r\n        const tx = await this.initContract().defuse();\r\n\r\n        await tx.wait();\r\n        this.getNextTimeStamp();\r\n        this.isActive();\r\n        this.handleDefuseCancel();\r\n    };\r\n\r\n    defuseModal = () => {\r\n        this.setState({ isModalDefuseVisible: true });\r\n    }\r\n\r\n    handleDefuseCancel = () => {\r\n        this.setState({ isModalDefuseVisible: false });\r\n    }\r\n\r\n    async componentDidMount() {\r\n        try {\r\n            await this.isActive();\r\n            await this.getUrl();\r\n            await this.getNextTimeStamp();\r\n        } catch (e) {\r\n            console.log(e)\r\n        }\r\n    }\r\n\r\n\r\n    render() {\r\n        // Add error message if user denies transactions\r\n        return (\r\n            <div>\r\n                {/* Give more emphasis to this */}\r\n                <Divider plain>Interact with Smart Contract</Divider>\r\n                <Paragraph>Contract Address: <Text underline>{this.props.address}</Text></Paragraph>\r\n                {this.state.pendingTx ? <Spin indicator={antIcon} style={{ width: \"100%\", marginTop: \"4rem\" }} /> : (\r\n                    <Space direction=\"vertical\">\r\n\r\n                        <Paragraph>Status of switch: <Text underline>{this.state.active === true ? \"still \" : \"not \"} being monitored. </Text></Paragraph>\r\n                        <Paragraph>Next timestamp: <Text underline>{this.state.nextTimeStamp}</Text></Paragraph>\r\n                        <Paragraph>URL to file: <Text underline>{this.state.url === \"\" ? \"There was no URL set or was left blank\" : this.state.url}</Text></Paragraph>\r\n\r\n                        <Tooltip title=\"Update the switch by updating the next timestamp of when the switch should activate\">\r\n                            <Button onClick={this.tick}>Check on Switch</Button>\r\n                        </Tooltip>\r\n                        <Tooltip title=\"Defuse the dead man's switch\">\r\n                            <Button onClick={this.defuse}>Defuse</Button>\r\n                        </Tooltip>\r\n                        <Tooltip title=\"Change the owner of the contract to 0x0. You will no longer be able to interact with the contract and will activate if not already defused\">\r\n                            <Button onClick={this.renounceOwnershipModal}>Renounce Ownership</Button>\r\n                        </Tooltip>\r\n\r\n                        <Tooltip title=\"Set the URL of the encrypted file\">\r\n                            <Button onClick={this.setUrl}>Set Url</Button>\r\n                        </Tooltip>\r\n                        <Input size=\"large\" id=\"setUrl\" />\r\n\r\n                        <Button onClick={this.getDecryptionKey}>Reveal Decryption Key</Button>\r\n                        {this.state.showDecryptionKeyText && <Paragraph>{this.state.decryptionKey}</Paragraph>}\r\n                    </Space>\r\n                )}\r\n\r\n                <Modal id=\"renounce\" title=\"Are you sure?\" visible={this.state.isModalRenounceVisible}\r\n                    footer={[\r\n                        <Button key=\"back\" onClick={this.handleRenounceCancel}>Cancel</Button>,\r\n                        <Button key=\"submit\" onClick={this.renounceOwnership}>Renounce Ownership</Button>\r\n                    ]}>\r\n                    <Paragraph>Renouncing the ownership of the Dead Man's Switch means that if not defused, there is no stopping the switch from activating.</Paragraph>\r\n                    <Paragraph>This action is is irreversible.</Paragraph>\r\n                </Modal>\r\n\r\n                <Modal id=\"defuse\" title=\"Are you sure?\" visible={this.state.isModalDefuseVisible}\r\n                    footer={[\r\n                        <Button key=\"back\" onClick={this.defuse} >Cancel</Button>,\r\n                        <Button key=\"submit\" onClick={this.handleDefuseCancel}>Defuse</Button>\r\n                    ]}>\r\n                    <Paragraph>Defusing the Dead Man's Switch means that the danger has passed and the use of the switch is no longer needed. The decryption key\r\n                        will not be revealed and you will no longer need to check on the switch.</Paragraph>\r\n                    <Paragraph>This action is is irreversible.</Paragraph>\r\n                </Modal>\r\n            </div>\r\n        );\r\n    };\r\n}\r\n\r\nexport default ContractInteraction;"]},"metadata":{},"sourceType":"module"}