{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\samba\\\\Desktop\\\\ETH Projects\\\\dead-mans-switch\\\\dead-mans-switch-front-end\\\\src\\\\components\\\\contractInteraction.jsx\";\nimport { Modal, Button, Space, Input, Spin, Typography } from 'antd';\nimport React from 'react';\nimport DeadMansContract from '../utils/DeadMansContract.abi.json';\nimport { ethers } from \"ethers\";\nimport { LoadingOutlined } from '@ant-design/icons';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst antIcon = /*#__PURE__*/_jsxDEV(LoadingOutlined, {\n  style: {\n    fontSize: 92,\n    width: 100\n  },\n  spin: true\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 7,\n  columnNumber: 17\n}, this);\n\nconst {\n  Paragraph\n} = Typography;\n\nclass ContractInteraction extends React.Component {\n  constructor() {\n    super();\n\n    this.initContract = () => {\n      if (this.state.contract == undefined) {\n        const provider = new ethers.providers.Web3Provider(ethereum);\n        const signer = provider.getSigner();\n        const contract = new ethers.Contract(this.props.address, DeadMansContract.abi, signer);\n        this.setState({\n          contract: contract\n        });\n        return contract;\n      } else {\n        return this.state.contract;\n      }\n    };\n\n    this.isActive = async () => {\n      try {\n        const tx = await this.initContract().isActive();\n        this.setState({\n          pendingTx: false,\n          active: tx\n        });\n      } catch (e) {\n        setTimeout(() => {\n          // For some reason when this compontent init's this function doesn't properly execute when initing the contract. This is a temp fix\n          this.isActive();\n        }, 100);\n      }\n    };\n\n    this.tick = async () => {\n      try {\n        const tx = await this.initContract().tick();\n        this.setState({\n          pendingTx: true\n        });\n        await tx.wait();\n        this.setState({\n          pendingTx: false\n        });\n        this.getNextTimeStamp();\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    this.getNextTimeStamp = async () => {\n      try {\n        const tx = await this.initContract().getNextTimeStamp();\n        this.setState({\n          pendingTx: false,\n          nextTimeStamp: Date(parseInt(BigInt(tx))).toString()\n        });\n      } catch (e) {}\n    };\n\n    this.setUrl = async () => {\n      try {\n        const newUrl = document.getElementById(\"setUrl\").value;\n        const tx = await this.initContract().setUrl(newUrl);\n        this.setState({\n          pendingTx: true\n        });\n        await tx.wait();\n        this.setState({\n          pendingTx: false\n        });\n        this.getUrl();\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    this.getUrl = async () => {\n      try {\n        const tx = await this.initContract().getUrl();\n        this.setState({\n          pendingTx: true\n        });\n        this.setState({\n          pendingTx: false,\n          url: tx\n        });\n      } catch (e) {\n        console.log(e);\n      }\n    };\n\n    this.getDecryptionKey = async () => {\n      try {\n        const tx = await this.initContract().getDecryptionKey();\n        await tx.wait();\n        this.setState({\n          showDecryptionKeyText: true,\n          decryptionKey: tx\n        });\n      } catch (e) {\n        this.setState({\n          showDecryptionKeyText: true,\n          decryptionKey: \"The switch has not been activated yet\"\n        });\n      }\n    };\n\n    this.renounceOwnershipModal = () => {\n      this.setState({\n        isModalRenounceVisible: true\n      });\n    };\n\n    this.renounceOwnership = async () => {\n      const tx = await this.initContract().renounceOwnership();\n      await tx.wait();\n      this.handleRenounceCancel();\n    };\n\n    this.handleRenounceCancel = () => {\n      this.setState({\n        isModalRenounceVisible: false\n      });\n    };\n\n    this.defuse = async () => {\n      const tx = await this.initContract().defuse();\n      await tx.wait();\n      this.handleDefuseCancel();\n    };\n\n    this.defuseModal = () => {\n      this.setState({\n        isModalDefuseVisible: true\n      });\n    };\n\n    this.handleDefuseCancel = () => {\n      this.setState({\n        isModalDefuseVisible: false\n      });\n    };\n\n    this.state = {\n      active: false,\n      url: \"\",\n      decryptionKey: \"\",\n      nextTimeStamp: \"\",\n      pendingTx: false,\n      showTickText: false,\n      showGetDecryptionText: false,\n      isModalRenounceVisible: false,\n      isModalDefuseVisible: false\n    };\n  }\n\n  async componentDidMount() {\n    try {\n      await this.isActive();\n      await this.getUrl();\n      await this.getNextTimeStamp();\n    } catch (e) {\n      console.log(e);\n    }\n  }\n\n  render() {\n    // Add error message if user denies transactions\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(Paragraph, {\n        children: [\"Contract Address: \", this.props.address]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 17\n      }, this), this.state.pendingTx ? /*#__PURE__*/_jsxDEV(Spin, {\n        indicator: antIcon,\n        style: {\n          width: \"100%\",\n          marginTop: \"4rem\"\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 41\n      }, this) : /*#__PURE__*/_jsxDEV(Space, {\n        direction: \"vertical\",\n        children: [/*#__PURE__*/_jsxDEV(Paragraph, {\n          children: [\"The switch is \", this.state.active === true ? \"still \" : \"not \", \" being monitored.\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(Paragraph, {\n          children: [\"Next timestamp: \", this.state.nextTimeStamp]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(Paragraph, {\n          children: [\"URL to file: \", this.state.url === \"\" ? \"There was no URL set or was left blank\" : this.state.url]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: this.tick,\n          children: \"Add Time\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: this.defuse,\n          children: \"Defuse\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: this.renounceOwnershipModal,\n          children: \"Renounce Ownership\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: this.setUrl,\n          children: \"Set Url\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(Input, {\n          size: \"large\",\n          id: \"setUrl\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: this.getDecryptionKey,\n          children: \"Reveal Decryption Key\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 25\n        }, this), this.state.showDecryptionKeyText && /*#__PURE__*/_jsxDEV(Paragraph, {\n          children: this.state.decryptionKey\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 173,\n          columnNumber: 62\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(Modal, {\n        id: \"renounce\",\n        title: \"Are you sure?\",\n        visible: this.state.isModalRenounceVisible,\n        footer: [/*#__PURE__*/_jsxDEV(Button, {\n          onClick: this.handleRenounceCancel,\n          children: \"Cancel\"\n        }, \"back\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: this.renounceOwnership,\n          children: \"Renounce Ownership\"\n        }, \"submit\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 25\n        }, this)],\n        children: [/*#__PURE__*/_jsxDEV(Paragraph, {\n          children: \"Renouncing the ownership of the Dead Man's Switch means that if not defused, there is no stopping the switch from activating.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Paragraph, {\n          children: \"This action is is irreversible.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Modal, {\n        id: \"defuse\",\n        title: \"Are you sure?\",\n        visible: this.state.isModalDefuseVisible,\n        footer: [/*#__PURE__*/_jsxDEV(Button, {\n          onClick: this.defuse,\n          children: \"Cancel\"\n        }, \"back\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: this.handleDefuseCancel,\n          children: \"Defuse\"\n        }, \"submit\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 25\n        }, this)],\n        children: [/*#__PURE__*/_jsxDEV(Paragraph, {\n          children: \"Defusing the Dead Man's Switch means that the danger has passed and the use of the switch is no longer needed. The decryption key will not be revealed and you will no longer need to check on the switch.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Paragraph, {\n          children: \"This action is is irreversible.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 13\n    }, this);\n  }\n\n} // ) Check on deployed Contract functionality\n// 1) Dark screen mode\n// 2) Add routing to show the contract on a different page\n// 3) Host on IPFS\n\n\nexport default ContractInteraction;","map":{"version":3,"sources":["C:/Users/samba/Desktop/ETH Projects/dead-mans-switch/dead-mans-switch-front-end/src/components/contractInteraction.jsx"],"names":["Modal","Button","Space","Input","Spin","Typography","React","DeadMansContract","ethers","LoadingOutlined","antIcon","fontSize","width","Paragraph","ContractInteraction","Component","constructor","initContract","state","contract","undefined","provider","providers","Web3Provider","ethereum","signer","getSigner","Contract","props","address","abi","setState","isActive","tx","pendingTx","active","e","setTimeout","tick","wait","getNextTimeStamp","console","log","nextTimeStamp","Date","parseInt","BigInt","toString","setUrl","newUrl","document","getElementById","value","getUrl","url","getDecryptionKey","showDecryptionKeyText","decryptionKey","renounceOwnershipModal","isModalRenounceVisible","renounceOwnership","handleRenounceCancel","defuse","handleDefuseCancel","defuseModal","isModalDefuseVisible","showTickText","showGetDecryptionText","componentDidMount","render","marginTop"],"mappings":"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","sourcesContent":["import { Modal, Button, Space, Input, Spin, Typography } from 'antd';\r\nimport React from 'react';\r\nimport DeadMansContract from '../utils/DeadMansContract.abi.json';\r\nimport { ethers } from \"ethers\";\r\nimport { LoadingOutlined } from '@ant-design/icons';\r\n\r\nconst antIcon = <LoadingOutlined style={{ fontSize: 92, width: 100 }} spin />;\r\nconst { Paragraph } = Typography;\r\n\r\nclass ContractInteraction extends React.Component {\r\n\r\n    constructor() {\r\n        super();\r\n        this.state = {\r\n            active: false,\r\n            url: \"\",\r\n            decryptionKey: \"\",\r\n            nextTimeStamp: \"\",\r\n            pendingTx: false,\r\n            showTickText: false,\r\n            showGetDecryptionText: false,\r\n            isModalRenounceVisible: false,\r\n            isModalDefuseVisible: false\r\n        };\r\n    }\r\n\r\n    initContract = () => {\r\n        if (this.state.contract == undefined) {\r\n            const provider = new ethers.providers.Web3Provider(ethereum);\r\n            const signer = provider.getSigner();\r\n            const contract = new ethers.Contract(this.props.address, DeadMansContract.abi, signer);\r\n            this.setState({ contract: contract });\r\n            return contract;\r\n        } else {\r\n            return this.state.contract;\r\n        }\r\n    }\r\n\r\n    isActive = async () => {\r\n        try {\r\n            const tx = await this.initContract().isActive();\r\n\r\n            this.setState({ pendingTx: false, active: tx });\r\n        } catch (e) {\r\n            setTimeout(() => {\r\n                // For some reason when this compontent init's this function doesn't properly execute when initing the contract. This is a temp fix\r\n                this.isActive();\r\n            }, 100);\r\n        }\r\n    };\r\n\r\n    tick = async () => {\r\n        try {\r\n            const tx = await this.initContract().tick();\r\n\r\n            this.setState({ pendingTx: true });\r\n\r\n            await tx.wait();\r\n            this.setState({ pendingTx: false })\r\n            this.getNextTimeStamp();\r\n        } catch (e) {\r\n            console.log(e);\r\n        }\r\n    };\r\n\r\n    getNextTimeStamp = async () => {\r\n        try {\r\n            const tx = await this.initContract().getNextTimeStamp();\r\n            this.setState({ pendingTx: false, nextTimeStamp: Date(parseInt(BigInt(tx))).toString() });\r\n        } catch (e) {\r\n\r\n        }\r\n    }\r\n\r\n    setUrl = async () => {\r\n        try {\r\n            const newUrl = document.getElementById(\"setUrl\").value;\r\n            const tx = await this.initContract().setUrl(newUrl);\r\n\r\n            this.setState({ pendingTx: true });\r\n            await tx.wait();\r\n            this.setState({ pendingTx: false });\r\n            this.getUrl();\r\n        } catch (e) {\r\n            console.log(e);\r\n        }\r\n    };\r\n\r\n    getUrl = async () => {\r\n        try {\r\n            const tx = await this.initContract().getUrl();\r\n            this.setState({ pendingTx: true });\r\n\r\n            this.setState({ pendingTx: false, url: tx });\r\n        } catch (e) {\r\n            console.log(e);\r\n        }\r\n    };\r\n\r\n    getDecryptionKey = async () => {\r\n        try {\r\n            const tx = await this.initContract().getDecryptionKey();\r\n\r\n            await tx.wait();\r\n            this.setState({ showDecryptionKeyText: true, decryptionKey: tx });\r\n        } catch (e) {\r\n            this.setState({ showDecryptionKeyText: true, decryptionKey: \"The switch has not been activated yet\" });\r\n        }\r\n    };\r\n\r\n    renounceOwnershipModal = () => {\r\n        this.setState({ isModalRenounceVisible: true });\r\n    }\r\n\r\n    renounceOwnership = async () => {\r\n        const tx = await this.initContract().renounceOwnership();\r\n\r\n        await tx.wait();\r\n        this.handleRenounceCancel();\r\n    };\r\n\r\n    handleRenounceCancel = () => {\r\n        this.setState({ isModalRenounceVisible: false });\r\n    };\r\n\r\n    defuse = async () => {\r\n        const tx = await this.initContract().defuse();\r\n\r\n        await tx.wait();\r\n        this.handleDefuseCancel();\r\n    };\r\n\r\n    defuseModal = () => {\r\n        this.setState({ isModalDefuseVisible: true });\r\n    }\r\n\r\n    handleDefuseCancel = () => {\r\n        this.setState({ isModalDefuseVisible: false });\r\n    }\r\n\r\n    async componentDidMount() {\r\n        try {\r\n            await this.isActive();\r\n            await this.getUrl();\r\n            await this.getNextTimeStamp();\r\n        } catch (e) {\r\n            console.log(e)\r\n        }\r\n    }\r\n\r\n\r\n    render() {\r\n        // Add error message if user denies transactions\r\n        return (\r\n            <div>\r\n                {/* Give more emphasis to this */}\r\n                <Paragraph>Contract Address: {this.props.address}</Paragraph>\r\n                {this.state.pendingTx ? <Spin indicator={antIcon} style={{ width: \"100%\", marginTop: \"4rem\" }} /> : (\r\n                    <Space direction=\"vertical\">\r\n\r\n                        <Paragraph>The switch is {this.state.active === true ? \"still \" : \"not \"} being monitored.</Paragraph>\r\n                        <Paragraph>Next timestamp: {this.state.nextTimeStamp}</Paragraph>\r\n                        <Paragraph>URL to file: {this.state.url === \"\" ? \"There was no URL set or was left blank\" : this.state.url}</Paragraph>\r\n\r\n                        <Button onClick={this.tick}>Add Time</Button>\r\n                        <Button onClick={this.defuse}>Defuse</Button>\r\n                        <Button onClick={this.renounceOwnershipModal}>Renounce Ownership</Button>\r\n\r\n                        <Button onClick={this.setUrl}>Set Url</Button>\r\n                        <Input size=\"large\" id=\"setUrl\" />\r\n\r\n                        <Button onClick={this.getDecryptionKey}>Reveal Decryption Key</Button>\r\n                        {this.state.showDecryptionKeyText && <Paragraph>{this.state.decryptionKey}</Paragraph>}\r\n                    </Space>\r\n                )}\r\n\r\n                <Modal id=\"renounce\" title=\"Are you sure?\" visible={this.state.isModalRenounceVisible}\r\n                    footer={[\r\n                        <Button key=\"back\" onClick={this.handleRenounceCancel}>Cancel</Button>,\r\n                        <Button key=\"submit\" onClick={this.renounceOwnership}>Renounce Ownership</Button>\r\n                    ]}>\r\n                    <Paragraph>Renouncing the ownership of the Dead Man's Switch means that if not defused, there is no stopping the switch from activating.</Paragraph>\r\n                    <Paragraph>This action is is irreversible.</Paragraph>\r\n                </Modal>\r\n\r\n                <Modal id=\"defuse\" title=\"Are you sure?\" visible={this.state.isModalDefuseVisible}\r\n                    footer={[\r\n                        <Button key=\"back\" onClick={this.defuse} >Cancel</Button>,\r\n                        <Button key=\"submit\" onClick={this.handleDefuseCancel}>Defuse</Button>\r\n                    ]}>\r\n                    <Paragraph>Defusing the Dead Man's Switch means that the danger has passed and the use of the switch is no longer needed. The decryption key\r\n                        will not be revealed and you will no longer need to check on the switch.</Paragraph>\r\n                    <Paragraph>This action is is irreversible.</Paragraph>\r\n                </Modal>\r\n            </div>\r\n        );\r\n    };\r\n}\r\n\r\n// ) Check on deployed Contract functionality\r\n// 1) Dark screen mode\r\n// 2) Add routing to show the contract on a different page\r\n// 3) Host on IPFS\r\n\r\nexport default ContractInteraction;"]},"metadata":{},"sourceType":"module"}